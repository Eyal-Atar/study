---
phase: 17-split-brain-core-scheduler
plan: 04
type: execute
wave: 4
depends_on: ["17-03"]
files_modified:
  - index.html
  - frontend/js/tasks.js
  - frontend/js/calendar.js
  - frontend/css/styles.css
  - backend/brain/exam_brain.py
  - backend/brain/routes.py
autonomous: true
requirements: [SB-05, SB-08]
user_setup: []

must_haves:
  truths:
    - "Dashboard shows Daily Progress against the net study hours quota instead of total tasks done"
    - "Completing a task updates the Daily Progress calculation"
    - "Obsolete single-call AI methods are removed from ExamBrain"
    - "Auditor draft is cleared from the database after a schedule is successfully approved"
    - "Padding tasks are visually distinct in the calendar/focus view"
  artifacts:
    - path: "frontend/js/tasks.js"
      provides: "Daily progress calculation in updateStats()"
      contains: "neto_study_hours"
    - path: "backend/brain/routes.py"
      provides: "Draft cleanup logic"
      contains: "auditor_draft"
  key_links:
    - from: "frontend/js/tasks.js"
      to: "index.html"
      via: "DOM manipulation of progress stat"
      pattern: "stat-done"
---

<objective>
Implement Dashboard Sync (XP Progress Bar) and perform final Phase 17 cleanup.

Purpose: This plan completes Phase 17 by ensuring the UI provides meaningful feedback on daily progress (6-hour quota enforcement) and by removing legacy AI code that has been replaced by the Split-Brain architecture. It also ensures that padding tasks are identifiable and that intermediate AI drafts are cleaned up.

Output: An updated dashboard with daily progress tracking, visually distinct padding tasks, and a clean backend codebase.
</objective>

<execution_context>
@/Users/eyalatar/.claude/get-shit-done/workflows/execute-plan.md
@/Users/eyalatar/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/17-split-brain-core-scheduler/17-CONTEXT.md
@.planning/phases/17-split-brain-core-scheduler/17-RESEARCH.md
@index.html
@frontend/js/tasks.js
@frontend/js/calendar.js
@frontend/css/styles.css
@backend/brain/exam_brain.py
@backend/brain/routes.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Dashboard Sync (Daily Quota Progress)</name>
  <files>index.html, frontend/js/tasks.js, frontend/css/styles.css</files>
  <action>
**index.html:**
- Locate the "Tasks Done" stat cards (ID `stat-done` and `stat-done-desktop`).
- Change the labels from "Tasks Done" to "Daily Progress".
- Add a progress bar container below or within these cards (e.g., `<div class="h-1.5 bg-dark-900/60 rounded-full mt-2 overflow-hidden"><div id="daily-quota-progress" class="h-full bg-mint-500 transition-all" style="width:0%"></div></div>`).

**frontend/js/tasks.js:**
- Update `updateStats()`:
  - Fetch `neto_study_hours` from `getCurrentUser()` (default to 4.0 if not found).
  - Identify today's local date (YYYY-MM-DD).
  - Calculate `todayDoneMin`: Filter `getCurrentSchedule()` for blocks where `day_date` is today, `block_type` is "study", and `completed` is 1. Sum their durations in minutes.
  - Calculate `quotaMin = neto_study_hours * 60`.
  - Calculate `dailyPct = Math.min(100, Math.round((todayDoneMin / quotaMin) * 100))`.
  - Update `stat-done` / `stat-done-desktop` text to show `${dailyPct}%`.
  - Update the new `daily-quota-progress` width style to `${dailyPct}%`.
  - Add a sub-label or tooltip showing `${Math.round(todayDoneMin/60 * 10)/10}/${neto_study_hours}h`.

**frontend/css/styles.css:**
- Ensure the new daily progress bar has a smooth transition for width changes.
  </action>
  <verify>
1. Open the dashboard.
2. Complete a study task scheduled for today.
3. Verify the "Daily Progress" percentage increases and the progress bar moves.
4. Verify the fractional hours (e.g., 1.5/6h) reflect the actual completed minutes.
  </verify>
  <done>The dashboard successfully motivates the user to hit their daily study quota by providing clear, real-time feedback.</done>
</task>

<task type="auto">
  <name>Task 2: Distinguish Padding Tasks in UI</name>
  <files>frontend/js/calendar.js, frontend/css/styles.css</files>
  <action>
**frontend/js/calendar.js:**
- In `renderHourlyGrid()`, check the `block.task_title`.
- If the title starts with "General Review:" or "Solve Practice Problems:" (as generated by the Strategist in Plan 03):
  - Add a `block-padding` class to the block's `div` element.
  - Add a small enrichment icon (e.g., üõ°Ô∏è) or a "Review" badge next to the title.

**frontend/css/styles.css:**
- Add styling for `.block-padding`:
  - Use a distinct border style (e.g., `border-left-style: double` or a specific color).
  - Maybe a slightly lighter or desaturated background to differentiate from core syllabus tasks.
  </action>
  <verify>
1. Generate a schedule that includes padding tasks (i.e., when total syllabus material is less than the daily quota).
2. Open the roadmap.
3. Verify that padding tasks have a distinct visual appearance (badge/border).
  </verify>
  <done>Users can easily distinguish between core syllabus tasks and AI-generated padding/enrichment tasks.</done>
</task>

<task type="auto">
  <name>Task 3: Final Backend Cleanup & Draft Clearing</name>
  <files>backend/brain/exam_brain.py, backend/brain/routes.py</files>
  <action>
**backend/brain/exam_brain.py:**
- Remove the obsolete `analyze_all_exams`, `_analyze_single_exam_with_ai`, and `_build_strategy_prompt` methods.
- Ensure the class only contains the new Split-Brain methods (`call_split_brain`, `call_strategist`, etc.).

**backend/brain/routes.py:**
- In the `POST /brain/approve-and-schedule` route (implemented in Plan 03):
  - After successfully saving the schedule and tasks, add a database call to clear the `auditor_draft` column for the user's exams (e.g., `UPDATE exams SET auditor_draft = NULL WHERE user_id = ?`).
  </action>
  <verify>
1. Verify `backend/brain/exam_brain.py` no longer contains `analyze_all_exams`.
2. Generate and approve a roadmap.
3. Check the database and verify that the `auditor_draft` column for the affected exams is NULL.
  </verify>
  <done>The codebase is clean of legacy methods, and the intermediate draft state is correctly reset after use.</done>
</task>

</tasks>

<verification>
- Dashboard shows Daily Progress against the 6-hour quota
- Progress updates dynamically on task completion
- Padding tasks are visually distinct in the calendar
- Legacy AI methods are removed from backend
- Auditor draft is cleared after approval
</verification>

<success_criteria>
Phase 17 is successfully completed. The system now utilizes a sophisticated Split-Brain AI architecture with strict daily quota enforcement, and the UI provides clear feedback on the student's progress toward their daily goals.
</success_criteria>

<output>
After completion, create `.planning/phases/17-split-brain-core-scheduler/17-04-SUMMARY.md`
</output>

---
phase: 17-split-brain-core-scheduler
plan: 05
type: execute
wave: 4
depends_on:
  - 17-03
  - 17-04
files_modified:
  - frontend/js/tasks.js
  - frontend/js/brain.js
autonomous: false
requirements:
  - SB-08
  - SB-01

must_haves:
  truths:
    - "XP Progress Bar shows completion percentage against strict daily hour quota"
    - "Progress bar reflects today's completed study blocks vs neto_study_hours target"
    - "Full split-brain flow works end-to-end: Generate → Review → Approve → Schedule → Track Progress"
  artifacts:
    - path: "frontend/js/tasks.js"
      provides: "Updated updateStats() with daily quota percentage"
      contains: "quotaMin"
  key_links:
    - from: "frontend/js/tasks.js"
      to: "schedule data"
      via: "calculates today's completed minutes vs daily quota"
      pattern: "neto_study_hours"
---

<objective>
Update the XP Progress Bar to show daily quota completion and verify the full split-brain flow end-to-end.

Purpose: With the hard daily quota now enforced by the Enforcer, the progress bar should reflect how much of today's quota the student has completed. This is the final integration piece and user-facing dashboard sync.
Output: Updated progress bar, verified end-to-end flow.
</objective>

<execution_context>
@/Users/eyalatar/.claude/get-shit-done/workflows/execute-plan.md
@/Users/eyalatar/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/17-split-brain-core-scheduler/17-RESEARCH.md
@.planning/phases/17-split-brain-core-scheduler/17-03-SUMMARY.md
@.planning/phases/17-split-brain-core-scheduler/17-04-SUMMARY.md
@frontend/js/tasks.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update XP Progress Bar for daily quota tracking</name>
  <files>frontend/js/tasks.js</files>
  <action>
In `updateStats()` (or the equivalent function that renders the progress bar and stat elements):

1. Calculate today's study progress against the daily quota:
   ```javascript
   const today = new Date().toISOString().split('T')[0];
   const todaySchedule = (getCurrentSchedule() || []).filter(
     b => b.day_date === today && b.block_type === 'study'
   );
   const todayDoneMin = todaySchedule
     .filter(b => b.completed === 1)
     .reduce((sum, b) => {
       const start = new Date(b.start_time);
       const end = new Date(b.end_time);
       return sum + (end - start) / 60000;
     }, 0);
   const quotaMin = (getCurrentUser()?.neto_study_hours || 4.0) * 60;
   const dailyPct = Math.min(100, Math.round((todayDoneMin / quotaMin) * 100));
   ```

2. Update the progress bar element (likely `stat-done` or a dedicated element) to show `dailyPct` as the fill percentage. Update the label to show something like "2.5 / 6 hrs today" (completed hours vs quota).

3. Keep the existing task-count display (`done/total tasks`) alongside the new daily quota display. The quota bar is an addition, not a replacement. If screen space is tight, show the quota bar as the primary metric and task count as secondary text below.

4. If there's no schedule yet (user hasn't generated one), show "No schedule yet" instead of 0%.

Use the exact pattern from 17-RESEARCH.md's "XP Progress Bar Update" code example, adapted to the actual element IDs in the current tasks.js.
  </action>
  <verify>
Open the app with a generated schedule. Mark some tasks as complete. The progress bar should update to show the percentage of today's quota completed. Verify it shows correct hours (e.g., "1.5 / 6 hrs" after completing 90 min of study blocks).
  </verify>
  <done>Progress bar shows daily quota completion percentage. Label shows completed hours vs target hours.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: End-to-end split-brain flow verification</name>
  <files>index.html, frontend/js/tasks.js, frontend/js/brain.js</files>
  <action>
Human verification checkpoint. What was built: Complete Split-Brain Core Intelligence Engine — two-call AI architecture (Auditor + Strategist), intermediate review page with gap detection, Python Enforcer with hard daily quota and padding, focus-score-aware scheduling, and daily quota progress tracking.
  </action>
  <verify>
1. Upload multiple files per exam (syllabus + summaries) — verify extracted_text is stored
2. Click "Generate Roadmap" — verify loading overlay appears
3. Review Page appears — verify topic map shows all syllabus topics, gaps are highlighted
4. Dismiss a gap — verify it's removed from the list
5. Click "Approve & Generate Schedule" — verify loading overlay, then calendar appears
6. Check schedule: high focus_score tasks should be in morning (if peak=Morning)
7. Check daily view: each day should have close to the daily hour quota filled
8. Mark some tasks complete — verify progress bar updates (e.g., "1.5 / 6 hrs")
9. Refresh the page — verify schedule and progress persist
10. Try the flow on mobile — verify review page is scrollable and buttons are reachable
  </verify>
  <done>User approves the full split-brain flow. Type "approved" or describe issues to fix.</done>
</task>

</tasks>

<verification>
1. Progress bar accurately reflects daily quota completion
2. Full flow works: Upload → Generate → Review → Approve → Schedule → Track
3. Schedule fills daily quota with padding when needed
4. High focus tasks placed in peak productivity windows
5. Mobile layout works for review page
6. Page refresh preserves state at every stage
</verification>

<success_criteria>
- XP Progress Bar shows daily quota % (not just task count)
- Full split-brain flow verified by human testing
- No regressions in existing features (task editing, drag, notifications)
- Mobile-friendly throughout
</success_criteria>

<output>
After completion, create `.planning/phases/17-split-brain-core-scheduler/17-05-SUMMARY.md`
</output>

---
requirements: ["PROF-01", "PROF-02"]
depends_on: ["06"]
must_haves:
  truths:
    - User profile data (hobby, study hours, productivity peak) persists in the database and is correctly returned via the API.
    - UserResponse and UserUpdate schemas include all profile fields required for the onboarding wizard.
  artifacts:
    - path: "backend/server/database.py"
      provides: "updated init_db with profile columns"
    - path: "backend/users/schemas.py"
      provides: "updated UserResponse and UserUpdate Pydantic models"
  key_links:
    - from: "backend/users/routes.py"
      to: "backend/server/database.py"
      via: "get_db() and SQL UPDATE users"
---

# Plan: Phase 07-01 - Profile Backend & Database

Implement the database schema and API schemas for user profiles and hobby preferences.

<task id="db_migration">
  <files>
    <file>backend/server/database.py</file>
  </files>
  <action>
    Add the following columns to the `users` table in `init_db`:
    - `hobby_name` (TEXT)
    - `neto_study_hours` (REAL DEFAULT 4.0)
    - `peak_productivity` (TEXT DEFAULT 'Morning')
    - `onboarding_completed` (INTEGER DEFAULT 0)
    
    Add migration checks to ensure columns are added to existing databases.
  </action>
  <verify>
    Run `sqlite3 backend/data.db "PRAGMA table_info(users)"` and verify the new columns exist.
  </verify>
  <done>[x] true</done>
</task>

<task id="update_schemas">
  <files>
    <file>backend/users/schemas.py</file>
  </files>
  <action>
    Update `UserResponse` and `UserUpdate` schemas to include:
    - `hobby_name: Optional[str]`
    - `neto_study_hours: Optional[float]`
    - `peak_productivity: Optional[str]`
    - `onboarding_completed: Optional[int]`
  </action>
  <verify>
    Check if `backend/users/routes.py` uses these schemas (it does for `UserResponse` and `UserUpdate`).
  </verify>
  <done>[x] true</done>
</task>

<task id="update_user_routes">
  <files>
    <file>backend/users/routes.py</file>
  </files>
  <action>
    Ensure `update_profile` (`PATCH /users/me`) correctly handles the new fields by using `body.model_dump(exclude_none=True)`.
  </action>
  <verify>
    Run the backend and test `PATCH /users/me` with a new field (e.g., `hobby_name`) using `curl` or a test script.
  </verify>
  <done>[x] true</done>
</task>

---
phase: 05-frontend-modularization
plan: 03
type: execute
wave: 3
depends_on: ["05-02"]
files_modified: [frontend/js/app.js, frontend/index.html]
autonomous: true
requirements: [FE-MOD]
user_setup: []

must_haves:
  truths:
    - "index.html uses type="module" for app.js"
    - "All inline JS event handlers are replaced with addEventListener in modules"
    - "app.js correctly orchestrates module initialization"
  artifacts:
    - path: "frontend/js/app.js"
      provides: "Module orchestration and entry point"
    - path: "frontend/index.html"
      provides: "Cleaned up HTML with no inline JS handlers"
  key_links:
    - from: "frontend/js/app.js"
      to: "frontend/js/auth.js"
      via: "import { initAuth } from './auth.js'"
    - from: "frontend/js/app.js"
      to: "frontend/js/tasks.js"
      via: "import { initTasks } from './tasks.js'"
---

<objective>
Switch the application to use ES6 modules natively in the browser, refactor app.js to be the orchestration layer, and clean up index.html by removing inline event handlers.

Purpose: Achieve a modern, modular architecture with no global scope pollution.
Output: Final modular frontend.
</objective>

<execution_context>
@/Users/eyalatar/.gemini/get-shit-done/workflows/execute-plan.md
@/Users/eyalatar/.gemini/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/5-CONTEXT.md
@frontend/index.html
@frontend/js/app.js
@.planning/phases/05-frontend-modularization/05-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Refactor app.js to ES6 entry point</name>
  <files>frontend/js/app.js</files>
  <action>
    - Wipe out the current monolithic `app.js`.
    - Turn `app.js` into an ES6 module that imports `store.js`, `ui.js`, `auth.js`, `tasks.js`, `calendar.js`, and `brain.js`.
    - Implement a main initialization sequence that:
      1. Calls `initAuth()`.
      2. Checks for existing authentication in `store.js` (checking localStorage).
      3. If authenticated, calls `initTasks()` and initial data fetching/rendering.
      4. If not, shows the welcome screen.
    - Ensure `app.js` handles any cross-module dependencies not handled by the individual modules themselves.
  </action>
  <verify>app.js contains only imports and the main orchestration logic.</verify>
  <done>Entry point is clean and handles app lifecycle correctly.</done>
</task>

<task type="auto">
  <name>Task 2: Update index.html and verify functionality</name>
  <files>frontend/index.html</files>
  <action>
    - Update the `<script>` tag in `index.html` to include `type="module"`.
    - Systematically remove all `onclick`, `onkeydown`, and other inline JS attributes from all HTML elements.
    - Ensure all `addEventListener` calls in the feature modules (`auth.js`, `tasks.js`, `brain.js`, `ui.js`) correctly reference the DOM elements by their IDs.
    - Thoroughly verify that all features still work as expected (login, register, logout, dashboard, add exam, generate roadmap, brain chat, etc.).
  </action>
  <verify>index.html contains no inline JS and the app functions correctly in the browser.</verify>
  <done>Frontend is fully modularized and functional.</done>
</task>

</tasks>

<verification>
Perform a full regression test of the application in the browser. Check for console errors and scope leaks.
</verification>

<success_criteria>
- App uses native ES6 modules.
- Zero global variables or functions in window scope.
- index.html is free of inline JavaScript handlers.
- Functional equivalence with the original monolith.
</success_criteria>

<output>
After completion, create `.planning/phases/05-frontend-modularization/05-03-SUMMARY.md`
</output>

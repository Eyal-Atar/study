---
phase: 09-interactive-task-management
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [backend/tasks/routes.py, backend/tasks/schemas.py]
autonomous: true
requirements: [SCHED-03, TASK-01]

must_haves:
  truths:
    - "Backend can delete specific schedule blocks"
    - "Backend can update block details (title, start, end) individually"
  artifacts:
    - path: "backend/tasks/routes.py"
      provides: "DELETE and PATCH endpoints for schedule blocks"
    - path: "backend/tasks/schemas.py"
      provides: "BlockUpdate schema"
  key_links:
    - from: "backend/tasks/routes.py"
      to: "schedule_blocks table"
      via: "SQL UPDATE/DELETE"
---

<objective>
Provide backend support for manual task management by adding endpoints to update and delete individual schedule blocks.

Purpose: Enables the frontend to persist manual edits and deletions without regenerating the whole roadmap.
Output: New API endpoints for block-level operations.
</objective>

<execution_context>
@/Users/eyalatar/.gemini/get-shit-done/workflows/execute-plan.md
@/Users/eyalatar/.gemini/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@backend/tasks/routes.py
@backend/tasks/schemas.py
@backend/server/database.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement Block Management Endpoints</name>
  <files>backend/tasks/routes.py</files>
  <action>
    Add the following endpoints to `backend/tasks/routes.py`:
    1. `PATCH /tasks/block/{block_id}`:
       - Accepts `task_title`, `start_time`, `end_time`.
       - Updates the corresponding row in `schedule_blocks`.
       - If `task_id` is present, also updates the main `tasks` title if `task_title` changed.
    2. `DELETE /tasks/block/{block_id}`:
       - Deletes the block from `schedule_blocks`.
       - If it was a 'study' block, mark the associated `tasks` record as 'pending' or 'unscheduled' (set `day_date` to NULL) so it can be re-planned later.
    
    Ensure user ownership check: `WHERE id = ? AND user_id = ?`.
  </action>
  <verify>
    `curl -X PATCH -H "Authorization: Bearer $TOKEN" -d '{"task_title": "New Title"}' /api/tasks/block/1` returns 200.
    `curl -X DELETE -H "Authorization: Bearer $TOKEN" /api/tasks/block/1` returns 200.
  </verify>
  <done>Endpoints are functional and secure.</done>
</task>

<task type="auto">
  <name>Task 2: Add Block Update Schemas</name>
  <files>backend/tasks/schemas.py</files>
  <action>
    Create a `BlockUpdate` Pydantic schema with optional fields: `task_title`, `start_time`, `end_time`.
    Use this schema in the `PATCH /tasks/block/{block_id}` route.
  </action>
  <verify>Backend starts without schema errors.</verify>
  <done>Schemas are defined and used in routes.</done>
</task>

</tasks>

<verification>
Verify endpoints using a test script or manual curl calls with a valid JWT.
</verification>

<success_criteria>
Manual block updates and deletions persist in the database and are verifiable via the `/tasks` (which returns schedule) or direct DB query.
</success_criteria>

<output>
After completion, create `.planning/phases/09-interactive-task-management/09-01-SUMMARY.md`
</output>

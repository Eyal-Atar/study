---
phase: 09-interactive-task-management
plan: 03
type: execute
wave: 2
depends_on: [09-01, 09-02]
files_modified: [frontend/js/calendar.js, frontend/js/ui.js, frontend/css/styles.css]
autonomous: true
requirements: [SCHED-03, TASK-01]

must_haves:
  truths:
    - "Swiping left on a block reveals a red delete button"
    - "Deleting a hobby shows a playful confirmation message"
    - "Clicking a task block opens a modal to edit title, duration, and time"
    - "A red horizontal line shows the current time in the calendar grid"
  artifacts:
    - path: "frontend/js/calendar.js"
      provides: "renderCurrentTimeIndicator function and swipe logic"
    - path: "frontend/js/ui.js"
      provides: "showTaskEditModal function"
    - path: "frontend/css/styles.css"
      provides: ".current-time-line and .swipe-reveal-btn styles"
  key_links:
    - from: "calendar.js event delegation"
      to: "ui.js showTaskEditModal"
      via: "Function call"
    - from: "ui.js showTaskEditModal"
      to: "PATCH /api/tasks/block/{id}"
      via: "authFetch"
---

<objective>
Implement mobile-first gestures, the task editing UI, and visual enhancements like the current time indicator.

Purpose: Provide a complete, polished task management interface for both mobile and desktop.
Output: Swipe-to-delete, Edit Modal, and Current Time line.
</objective>

<execution_context>
@/Users/eyalatar/.gemini/get-shit-done/workflows/execute-plan.md
@/Users/eyalatar/.gemini/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@frontend/js/calendar.js
@frontend/js/ui.js
@frontend/css/styles.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: iOS-Style Swipe-to-Delete</name>
  <files>frontend/js/calendar.js, frontend/css/styles.css</files>
  <action>
    1. Define CSS for `.swipe-container` and `.delete-reveal-btn` (hidden until swiped).
    2. Add `touchstart` and `touchmove` listeners in `calendar.js` (via event delegation) to detect left-swipes on `.schedule-block`.
    3. Reveal the red delete button upon swipe.
    4. Implement playful confirmation for hobby blocks:
       - If `block.block_type === 'hobby'`, show a modal with a playful message (e.g., "Are you sure? Your brain cells might miss this break!").
       - If 'study', just show a standard confirmation.
    5. On confirm, call `DELETE /tasks/block/{id}` and refresh the calendar.
  </action>
  <verify>
    Swiping left on a task on a mobile device reveals a delete button. Clicking it deletes the task block.
  </verify>
  <done>Swipe-to-delete is functional with playful hobby feedback.</done>
</task>

<task type="auto">
  <name>Task 2: Task Edit Modal</name>
  <files>frontend/js/ui.js, frontend/js/calendar.js</files>
  <action>
    1. Implement `showTaskEditModal(block)` in `ui.js`:
       - Shows an overlay with Title, Start Time, and Duration (hours/minutes) inputs.
       - "Save" calls `PATCH /tasks/block/{id}`.
    2. Bind clicking on a block in `calendar.js` (if it wasn't a drag/swipe) to open this modal.
    3. Ensure the modal matches the existing UI aesthetic (dark theme, accent colors).
  </action>
  <verify>
    Clicking a block opens a modal, and changes saved in the modal are reflected in the calendar after refresh.
  </verify>
  <done>Task details can be edited manually via modal.</done>
</task>

<task type="auto">
  <name>Task 3: Current Time Indicator Line</name>
  <files>frontend/js/calendar.js, frontend/css/styles.css</files>
  <action>
    1. Implement `renderCurrentTimeIndicator()` in `calendar.js`:
       - Calculates the Y position: `(currentHours * 60 + currentMinutes) / 60 * HOUR_HEIGHT`.
       - Appends a horizontal red line (`.current-time-line`) to the grid.
       - Adds a small "NOW" label or circle on the left.
    2. Update the indicator every minute via `setInterval`.
    3. Only show if the current day view is 'TODAY'.
  </action>
  <verify>
    A red horizontal line appears in the calendar grid at the current time and moves periodically.
  </verify>
  <done>Visual time reference is available to the user.</done>
</task>

</tasks>

<verification>
Check all interactive features:
1. Swipe a block on mobile.
2. Click a block to open the edit modal.
3. Observe the current time line.
</verification>

<success_criteria>
User can fully manage tasks via swipe gestures, click modals, and visual time indicators, matching the high-fidelity mockups.
</success_criteria>

<output>
After completion, create `.planning/phases/09-interactive-task-management/09-03-SUMMARY.md`
</output>

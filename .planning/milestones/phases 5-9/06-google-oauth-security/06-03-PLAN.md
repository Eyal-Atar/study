---
phase: 06-google-oauth-security
plan: 03
type: execute
wave: 3
depends_on: [06-02]
files_modified: [frontend/js/store.js, frontend/js/auth.js, frontend/index.html, frontend/css/styles.css]
autonomous: true
requirements: [AUTH-01, AUTH-02]
---

<objective>
Update the frontend to support cookie-based authentication, integrate the "Sign in with Google" button, and implement the onboarding/welcome screen.

Purpose: Provide the user interface and frontend logic for OAuth.
Output: Working frontend for Google Sign-In and secure session management.
</objective>

<execution_context>
@/Users/eyalatar/.gemini/get-shit-done/workflows/execute-plan.md
@/Users/eyalatar/.gemini/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/research/06-google-oauth-research.md
@frontend/index.html
@frontend/js/auth.js
@frontend/js/store.js
@frontend/css/styles.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate Frontend to Cookies</name>
  <files>frontend/js/store.js, frontend/js/auth.js</files>
  <action>
    - Update `frontend/js/store.js`:
      - Remove `authToken` from the store.
      - Update `setAuthToken` to be a no-op (or remove its internal logic).
      - Remove `localStorage.getItem('studyflow_token')`.
      - Update `authHeaders` to return an empty object (Authorization header is no longer needed).
      - Update `authFetch` to include `credentials: 'include'`.
    - Update `frontend/js/auth.js`:
      - Update `handleLogin` and `handleRegister` to no longer look for `data.token`.
      - Ensure all fetch calls use `credentials: 'include'`.
  </action>
  <verify>Frontend no longer stores tokens in localStorage; fetch requests still work correctly.</verify>
  <done>Frontend is migrated to cookie-based sessions.</done>
</task>

<task type="auto">
  <name>Task 2: UI Updates (Google Sign-In Button)</name>
  <files>frontend/index.html, frontend/css/styles.css</files>
  <action>
    - Add "Sign in with Google" button to the `screen-login` section in `frontend/index.html`, below the "Log In" button.
    - Implement a divider ("Or continue with") between the login button and the Google button.
    - Style the Google button in `frontend/css/styles.css` according to branding guidelines (Google colors/logo).
    - Ensure the button's `href` points to `/auth/google/login`.
  </action>
  <verify>Google Sign-In button is visible on the login screen and looks good.</verify>
  <done>Google Sign-In button is integrated into the UI.</done>
</task>

<task type="auto">
  <name>Task 3: Onboarding/Welcome Screen</name>
  <files>frontend/index.html, frontend/js/ui.js, frontend/js/auth.js</files>
  <action>
    - Add a new `screen-onboarding` (or similar) section to `frontend/index.html` for first-time Google users.
    - This screen should provide a brief "Welcome to StudyFlow" message and a "Start Organizing" button that takes the user to the dashboard.
    - Update `frontend/js/ui.js` to handle this new screen.
    - Update `frontend/js/app.js` (or `auth.js`) to handle the redirection from `/onboarding`.
  </action>
  <verify>First-time Google users see the onboarding screen.</verify>
  <done>Onboarding screen is implemented.</done>
</task>

</tasks>

<verification>
- Verify no `studyflow_token` exists in `localStorage` after login.
- Verify `credentials: 'include'` is present in fetch requests.
- Verify Google button works (at least redirects to the backend).
- Verify welcome screen is accessible.
</verification>

<success_criteria>
- Frontend fully supports cookie-based sessions.
- Google Sign-In is prominently available as a login alternative.
- New Google users receive a dedicated welcome experience.
</success_criteria>

<output>
After completion, create `.planning/phases/06-google-oauth-security/06-03-SUMMARY.md`
</output>

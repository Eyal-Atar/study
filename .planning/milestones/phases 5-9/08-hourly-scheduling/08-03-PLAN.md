---
phase: 08-hourly-scheduling
plan: 03
type: execute
wave: 3
depends_on: [08-02]
files_modified: [frontend/js/calendar.js, frontend/css/styles.css]
autonomous: true
requirements: [SCHED-01, SCHED-02]

must_haves:
  truths:
    - "Hourly grid displays tasks with exact time slots"
    - "Delayed tasks are visually distinguished with a badge/color"
    - "UTC times are correctly converted to local time in the UI"
  artifacts:
    - path: "frontend/js/calendar.js"
      provides: "Exact time display and 'Delayed' badges"
    - path: "frontend/css/styles.css"
      provides: "Styles for 'Delayed' schedule blocks"
  key_links:
    - from: "frontend/js/calendar.js"
      to: "ScheduleBlock.is_delayed"
      via: "Conditional CSS class application"
---

<objective>
Update the UI to visually distinguish "Delayed" tasks and verify the robustness of hourly slot display and timezone handling.

Purpose: To provide users with clear feedback on their schedule status and ensure the hourly grid is polished and accurate.
Output: Enhanced hourly grid UI with "Delayed" indicators and exact time range labels.
</objective>

<execution_context>
@/Users/eyalatar/.gemini/get-shit-done/workflows/execute-plan.md
@/Users/eyalatar/.gemini/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-hourly-scheduling/08-CONTEXT.md
@.planning/phases/08-hourly-scheduling/08-RESEARCH.md
@.planning/phases/08-hourly-scheduling/08-02-SUMMARY.md
@frontend/js/calendar.js
@frontend/css/styles.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update Frontend for 'Delayed' Visibility</name>
  <files>frontend/js/calendar.js, frontend/css/styles.css</files>
  <action>
    - Update `renderHourlyGrid` in `frontend/js/calendar.js` to handle `block.is_delayed`.
    - If `block.is_delayed` is true, add a CSS class `block-delayed` and a "⚠️ Delayed" badge to the task card.
    - Update the time display inside the block to show the full range (e.g., "10:00 - 11:30") instead of just the start time.
    - Add styles for `.block-delayed` in `frontend/css/styles.css` (e.g., a dashed border or a subtle 'delayed' background pattern).
  </action>
  <verify>
    Verify that tasks marked as `is_delayed: 1` in the database are rendered with the "Delayed" badge and correct CSS class in the browser.
  </verify>
  <done>[x] Delayed tasks are visually distinct in the hourly grid.</done>
</task>

<task type="checkpoint:human-verify">
  <name>Task 2: Verify Padding, Visibility, and Timezone Handling</name>
  <what-built>Refactored Hourly Grid UI</what-built>
  <how-to-verify>
    - Open the application and login.
    - Generate a roadmap.
    - Verify that the hourly grid is readable, with correct padding for hour labels.
    - Check that tasks are positioned exactly at the hours shown in the legend.
    - Verify that the "Relax" (hobby) slot is present and colored correctly.
    - Change your computer's timezone (e.g., from UTC+2 to UTC-5) and refresh the page. Verify the tasks shift to the correct local time (since they are stored in UTC).
    - Ensure all Success Criteria for Phase 8 are met.
  </how-to-verify>
  <resume-signal>approved</resume-signal>
</task>

</tasks>

<verification>
- Visual check of "Delayed" tasks.
- Timezone shift verification.
- Padding and legend alignment verification.
</verification>

<success_criteria>
- Tasks show exact time slots.
- Delayed tasks are highlighted.
- UTC storage/Local display is robust.
- Phase 8 Success Criteria achieved.
</success_criteria>

<output>
After completion, create `.planning/phases/08-hourly-scheduling/08-03-SUMMARY.md`
</output>

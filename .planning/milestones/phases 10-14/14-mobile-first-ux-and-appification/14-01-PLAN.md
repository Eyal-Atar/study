---
phase: 14-mobile-first-ux-and-appification
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/index.html
  - frontend/js/app.js
  - frontend/js/calendar.js
  - frontend/js/interactions.js
autonomous: false

requirements:
  - MOBILE-UX-01

must_haves:
  truths:
    - "Browser loads new Phase 14 JS code without serving cached v=10 assets"
    - "Bottom tab bar appears on mobile viewport (< 768px) with 3 tabs: Roadmap, Focus, Exams"
    - "Tapping a tab switches the visible panel and updates the app bar title"
    - "Long-pressing a schedule block (>= 300ms) activates drag mode with haptic feedback"
    - "Drag respects scroll-lock and snaps to grid on release"
    - "Modals (Add Exam, Settings, Edit Task) slide up as bottom sheets on mobile"
  artifacts:
    - path: "frontend/index.html"
      provides: "HTML entry point with correct ?v=14 script tag"
      contains: "app.js?v=14"
    - path: "frontend/js/app.js"
      provides: "Module imports all at ?v=14"
      contains: "?v=14"
    - path: "frontend/js/calendar.js"
      provides: "Calendar module imports at ?v=14"
      contains: "?v=14"
    - path: "frontend/js/interactions.js"
      provides: "Touch drag module imports at ?v=14"
      contains: "?v=14"
  key_links:
    - from: "frontend/index.html"
      to: "frontend/js/app.js"
      via: "script src with cache-bust version"
      pattern: "app\\.js\\?v=14"
    - from: "frontend/js/app.js"
      to: "frontend/js/ui.js"
      via: "ES6 import"
      pattern: "ui\\.js\\?v=14"
---

<objective>
Ship the Phase 14 mobile-first UX changes to the browser by bumping the JS cache-bust version from v=10 to v=14, then verify the bottom tab bar, touch drag, and bottom-sheet modals work correctly on a mobile viewport.

Purpose: The implementation is already complete in HTML/CSS/JS — browsers are still serving the old v=10 files due to the unchanged version query string. This plan flushes the cache and validates the result.
Output: Version-bumped JS imports + human sign-off that the mobile UX works end-to-end.
</objective>

<execution_context>
@/Users/eyalatar/.claude/get-shit-done/workflows/execute-plan.md
@/Users/eyalatar/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/14-mobile-first-ux-and-appification/14-CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Bump JS cache-bust version from v=10 to v=14 across all affected files</name>
  <files>
    frontend/index.html
    frontend/js/app.js
    frontend/js/calendar.js
    frontend/js/interactions.js
  </files>
  <action>
    Update every occurrence of `?v=10` to `?v=14` in the following files:

    frontend/index.html — line 686:
      Change: `&lt;script type="module" src="/js/app.js?v=10"&gt;&lt;/script&gt;`
      To:     `&lt;script type="module" src="/js/app.js?v=14"&gt;&lt;/script&gt;`

    frontend/js/app.js — lines 12-17 (all module imports):
      Change all `?v=10` suffixes to `?v=14` on:
        ./store.js?v=10
        ./auth.js?v=10
        ./tasks.js?v=10
        ./brain.js?v=10
        ./interactions.js?v=10
        ./ui.js?v=10

    frontend/js/calendar.js — lines 1-2 (module imports):
      Change all `?v=10` suffixes to `?v=14` on:
        ./store.js?v=10
        ./ui.js?v=10

    frontend/js/interactions.js — line 6 (module import):
      Change `./store.js?v=10` to `./store.js?v=14`

    Do NOT change anything else — only the version query string numbers.
    Do NOT add any new imports or remove any existing code.

    Rationale: The browser caches ES6 modules by URL. Changing ?v=10 to ?v=14 forces a fresh
    fetch of all JS files, ensuring the Phase 14 mobile UX code (initMobileTabBar, touch drag,
    bottom-sheet CSS) is actually served to the browser rather than the cached v=10 versions.
  </action>
  <verify>
    After editing, run:
      grep -n "v=10" frontend/index.html frontend/js/app.js frontend/js/calendar.js frontend/js/interactions.js
    Expected output: no lines printed (zero matches).

    Then run:
      grep -n "v=14" frontend/index.html frontend/js/app.js frontend/js/calendar.js frontend/js/interactions.js
    Expected output: 9 matching lines total (1 in index.html, 6 in app.js, 2 in calendar.js, 1 in interactions.js).
  </verify>
  <done>
    Zero occurrences of ?v=10 remain in the four target files.
    Nine occurrences of ?v=14 exist across the four files.
    No other code was changed.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Verify mobile UX on mobile viewport</name>
  <what-built>
    Phase 14 mobile-first UX is fully implemented and now cache-busted to v=14:
    - Bottom tab bar (Roadmap / Focus / Exams) on screens under 768px wide
    - Mobile app bar with tab-title that updates on tab switch
    - Touch drag: long-press 300ms activates drag, vibrates, applies .dragging class (scale + shadow), locks scroll, edge-scrolls, snaps to grid on release
    - Bottom-sheet modals: Add Exam, Settings, Edit Task slide up from bottom on mobile
    - 44px touch targets on checkboxes
    - line-clamp on task titles in small blocks
    - Desktop layout (768px+) unchanged
  </what-built>
  <how-to-verify>
    1. Start the backend server (if not already running):
         cd backend && python -m uvicorn server:app --reload --port 8000

    2. Open http://localhost:8000 in Chrome DevTools with mobile emulation ON.
       Use a preset like "iPhone 14 Pro" (390px wide) or any width under 768px.

    3. Log in and reach the dashboard.

    4. Confirm the bottom tab bar is visible at the bottom of the screen with 3 tabs:
       "Roadmap" (calendar icon), "Focus" (lightning icon), "Exams" (book icon).

    5. Tap "Focus" tab — the calendar panel hides and "Today's Focus" list appears.
       The app bar title changes to "Today's Focus".

    6. Tap "Exams" tab — the Focus panel hides, the Exams list + Settings + Sign Out appear.
       The app bar title changes to "My Exams".

    7. Tap "Roadmap" tab — the Exams panel hides and the calendar reappears.

    8. If a roadmap with blocks exists: long-press (hold ~1 second) a schedule block.
       Expected: slight haptic buzz (on real device), block lifts with scale+shadow (.dragging class).
       Release the block — it snaps to the nearest 15-minute grid slot.

    9. Tap a schedule block briefly (quick tap under 300ms) — the Edit Task modal should
       slide up from the bottom as a sheet (not appear centered).

    10. Open Settings via the gear in the Exams tab — Settings modal should slide up from
        the bottom as a sheet.

    11. Switch to desktop emulation (1280px wide) — bottom tab bar should disappear,
        full desktop sidebar layout should be visible.
  </how-to-verify>
  <resume-signal>Type "approved" if all checks pass, or describe which step failed</resume-signal>
</task>

</tasks>

<verification>
All Phase 14 mobile UX features work on a mobile viewport:
- Bottom tab bar navigates between Roadmap, Focus, and Exams panels
- Tab title updates in the mobile app bar
- Touch long-press drag activates with haptic + visual feedback
- Bottom-sheet modals slide up from the bottom
- Desktop layout is unaffected at 768px+
- No v=10 cache references remain in JS imports
</verification>

<success_criteria>
- Zero occurrences of ?v=10 in frontend/index.html, app.js, calendar.js, interactions.js
- Human confirms bottom tab bar, touch drag, and bottom-sheet modals work on mobile viewport
- Desktop layout unchanged at 768px+
</success_criteria>

<output>
After completion, create `.planning/phases/14-mobile-first-ux-and-appification/14-01-SUMMARY.md`
</output>
